var Account = require('../../models/Account');
var RemoteTransaction = require('../../models/RemoteTransaction');
var jwt = require('../../Utilities/JWToken');
var Block =  require('../../models/BLock')
var config = require('../../config')


let TransactionServer = require('../../controllers/TransactionServer')


 exports.doLogin = function(req, res, next) {
     // console.log(res)
     var email = req.body.email;
     var password = req.body.password;


   /*  var transactions = [
      {
      "hash": "58d9ba8a199f84af4158add497603b5c4edb6a6429a873215dde3848903baf46",
      "inputs": [
      {
      "unlockScript": "DATETIME Tue Jan 02 2018 09:00:34 GMT+0000 (UTC)",
      "referencedOutputHash": "0000000000000000000000000000000000000000000000000000000000000000",
      "referencedOutputIndex": -1
      }
      ],
      "outputs": [
      {
      "value": 281190,
      "lockScript": "ADD aa5f720c8080d81b9bd9781bf85c38c4d24cc010d0536e667f169ac8a5eb72d0"
      }
      ],
      "version": 1
      },
      {
      "hash": "6cf8b93d4103f483da27292b69e6a36cb210b4a564debc823eda6c0d233b4741",
      "inputs": [
      {
      "unlockScript": "PUB 2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b426751437031707651686543466a4d754b52746639614c394d426b57680a4b6d46646a73424d5a57334846746f6d6876526433634355335a4d7475742f4e655a46566a6475617834534f30786f67475150574543304e67377a35464239470a525a4b426f724d4a6d725a457365653436636d2f4f3454614f444a2b416648715139682b6d73466634365a474c454d6f545a665162792f65523635387a3667610a68615146585463774364554e6967786b55774944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a SIG 270e25ebd967f133e8cf754a1c55374963ece00530a6365112476ce498c462090ad11c446be467aaefd1d69c6efdcf5267a4c000d9c950e491212a6e58b0d48a7f1b151dab06a4845860788d95e04c2369655d80a47ee445b72790038a2d3b68d5dd275c16acad430c696171ddbe4bc90eff9b4be86a11775f12346f390d7eb8",
      "referencedOutputHash": "24267de64869fb48f099ca96f02e36fe7da389b8234462b83de8ee60ea17b843",
      "referencedOutputIndex": 1
      },
      {
      "unlockScript": "PUB 2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b426751437031707651686543466a4d754b52746639614c394d426b57680a4b6d46646a73424d5a57334846746f6d6876526433634355335a4d7475742f4e655a46566a6475617834534f30786f67475150574543304e67377a35464239470a525a4b426f724d4a6d725a457365653436636d2f4f3454614f444a2b416648715139682b6d73466634365a474c454d6f545a665162792f65523635387a3667610a68615146585463774364554e6967786b55774944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a SIG 270e25ebd967f133e8cf754a1c55374963ece00530a6365112476ce498c462090ad11c446be467aaefd1d69c6efdcf5267a4c000d9c950e491212a6e58b0d48a7f1b151dab06a4845860788d95e04c2369655d80a47ee445b72790038a2d3b68d5dd275c16acad430c696171ddbe4bc90eff9b4be86a11775f12346f390d7eb8",
      "referencedOutputHash": "f83f75b877e9d2dd50c7753999b0d627a4521d1db107eb00080bea5749a33ac6",
      "referencedOutputIndex": 1
      }
      ],
      "outputs": [
      {
      "value": 500,
      "lockScript": "ADD 62c16a788f3a7bc905220231f68187e6708ef6f3465e3f174f786f8420bde874"
      },
      {
      "value": 100,
      "lockScript": "ADD fe80d7410c131e7b39804e9c72978c979bc1878a89bc58803fe447672bd15977"
      }
      ],
      "version": 1
      },
      {
      "hash": "273414b50fd3cc0c55fc3ca6e7a79aa1bcf6fdf71ac1c1daa8be89ca3bfd1bf6",
      "inputs": [
      {
      "unlockScript": "PUB 2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b426751444763495a414a4a6b3379674b416f4c6b447a457a2b383947770a734b354f5a6379417559595a32527134613455422f506f6b414161447934444d4b5a465a39694f3759342f2b37576a48334478754f5059504235486d335752630a48686848794336324e4e616a764f62416c463145687771494e6649427a71564d62626664654236543361356c45414478686f30785369772b776a4e70465878710a61334c557342454a536174546372734a74774944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a SIG 323711e2294e1d6668b2bd80451e783a0e1ca006a074b35dc3886da2775ff8388965649be9eb8f8a4a643411f677143d90bdc853ba4c0a74b62472e625aecd02e76f603da7037da1ae9328326869164cb6f351649680efede0ac3f8fee60f55fc2876ada5957672b069f179d6a7f46a9069fdd71d99e14480bc31fabce5af0d8",
      "referencedOutputHash": "d6fd4a290c22190d6c414f51c96a7eb800c1705e83d3931861f562935c1f831c",
      "referencedOutputIndex": 15
      }
      ],
      "outputs": [
      {
      "value": 100,
      "lockScript": "ADD f17230d4f6a3ecf5834b9b50b0775a6b52e97f8b33eb75bb5c9e9a7b5c7bf4b2"
      },
      {
      "value": 9900,
      "lockScript": "ADD e9af40b6a6669e30ad00c5a74230e74b1c13d72b87813111305f0416e53d3c97"
      }
      ],
      "version": 1
      },
      {
      "hash": "87c75b64f11e2ba6e7753f811af0bfc3c92ba6b281e799bff73df9e01704a2ad",
      "inputs": [
      {
      "unlockScript": "PUB 2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b426751436f676574664a493548515574715a6b50536f4b42472b7070720a306c6d6b506d464155553771766346365a2b3367386d68706b32615872596235464e69386937694f786d596744483068366445674134524d6f58596a443072510a33506f35476d34397857687848597241617649617836706354495473756b586a796a643737614e414538567748475a67364e765644766174344f6a70457661680a6456335557677a65494c32787466413477774944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a SIG 359a216595bbddf029c410a5610aae27a8a0abdd1095ced275e3594fab3a68ad62fcc8f55f8d8da74480f09a47dd3223d225ca322c315773f8db0f6229a72e5549ca403043656127851f0c4d44a76a58e78fb026eaaf701df7c898cf95d2d5e6f58c040c4136009ffa8aeac287d6edfce7ec0a587a234c4779fb462a765a6db4",
      "referencedOutputHash": "3552e23d2ca05011171d95f4c311d45ee1cf74a118a3a9f47aebe92fabba5ffd",
      "referencedOutputIndex": 0
      }
      ],
      "outputs": [
      {
      "value": 9992,
      "lockScript": "ADD 54218e5f6043b2ddedbf79d6eac2e044771e2208dc06dfebfebd87c39085ade6"
      },
      {
      "value": 1,
      "lockScript": "ADD 0a9a79e317e991abb94c2099f0e0e9a2b9c1f0505c3f7b9794b01c8c18af4f1b"
      }
      ],
      "version": 1
      },
      {
      "hash": "d25814adc39bd1b0d56b0ea015becebb06f6fef68df9b704b60e0ce17072c1ba",
      "inputs": [
      {
      "unlockScript": "PUB 2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b4267514374384668585069762b794d4341336137636b336d4869744d610a4c42757072722f784e4642546971766566424a594a755646444679542b46372f2b347577654e42727978434f72647361657776374a486f6c75364f4d4e6947360a684e57786e35756547446c646756485245595856586a63546a647a4c774c446e4d4478496b694a527658634a7a4249334239724a5039397570533152503455510a464d5041306b45714a706948714e496f39514944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a SIG 58134b027b210a0f2a9882981d5868928ad429aef2488ff02bc252a5567b4780ccf5613a901f54745666d7517c09d82588921c7d3d19111c08fa402d8be175aef383815d68eba5a00cf1fdf34378b68d0644757517db03fcb41316e640db5f61fa0a428e56b9be858613d405940090377f9e44d50fe1664b86e379d607125f1f",
      "referencedOutputHash": "0f3091d41e1ea0e22a9d86359178a799530b86456e8d10762233f5984bb102af",
      "referencedOutputIndex": 0
      }
      ],
      "outputs": [
      {
      "value": 25,
      "lockScript": "ADD b6238eeffa8f20399818dd6b95e606dfbc0dbc15a9d0b0e71e67ad4fd60fc5ef"
      },
      {
      "value": 1,
      "lockScript": "ADD 54e633857df16b28c71ed88ad427cb145cef28831b91786655d5c581be1f6568"
      }
      ],
      "version": 1
      },
      {
      "hash": "df269fd64b77e0578d90c769b5c86eca3863beb52cce397e1fc5ce89378dd8c4",
      "inputs": [
      {
      "unlockScript": "PUB 2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b4267514368543762544442456d4d364e72717046344433474a6c4c75780a4e774f6e6f6a43436e36396e61636937616c5534684c7a745a336744505632786a704d582b4b5261443157455a54766c377a5045586a5a635638797656794a770a6334767535326d6d347476524464324b5767544c43626a67764344567674705651647676594f37787a4e6975554679774950593552717567686335424d5841540a2f4438783479774b4a68714a517439536f774944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a SIG 45f77215ad49d0296f69a32d434effe38b7bd7abda6584794c67e6c985bd326be13c24c70800dd07b6e93184ce8bf817bf6c864f358719d1054ddd1c9b87f0b54c2347ddaa000473d772daa46c8bc505cabd4df921de9b5777241d729a4486e59579c69b7a4ddf9b11961e64c9543a0c22bef85364b4fd696aa4aa3d5026056c",
      "referencedOutputHash": "d6fd4a290c22190d6c414f51c96a7eb800c1705e83d3931861f562935c1f831c",
      "referencedOutputIndex": 5
      }
      ],
      "outputs": [
      {
      "value": 1,
      "lockScript": "ADD 8287c025e2ede5ab32d310be28433b4cee039e350a55dfdb43e8f52b25c21414"
      },
      {
      "value": 9999,
      "lockScript": "ADD 3e0dcfdcef801fc6dd968b475cdbfcbe2cd31934f36c5981c25a83d51c0125d5"
      }
      ],
      "version": 1
      }
      ]

      TransactionServer.SyncTransactions(transactions);*/


     Account.GetByEmail(email,function (err,account) {
         if(!account|| err) {
             res.send({
                 success: false,
                 message: 'Authentication failed. User not found.'
             });
         }else{
            Account.ComparePassword(password,account.password ,function(err, isMatch) {
                if(isMatch) {
                    if(!account.isActivated)
                        res.status(200).json({success: false, message: 'Account has not activated yet'})
                    else{
                        var token = jwt.create({email: account.email,
                                                _id:account._id,
                                                address: account.address,
                        });
                        res.status(200).json({
                            success: true,
                            message: 'Authentication success',
                            token: token
                        })
                    }
                } else{
                    res.status(200).json({
                        success: false,
                        message: 'Authentication fail, wrong password'
                    })
                }
            })
         }

     });

 }



exports.doLogout  = function(req, res, next) {
    res.status(200).send({success: true, token: null})
}

